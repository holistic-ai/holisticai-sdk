

<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Bias Measuring and Mitigation in Recommendation Systems &#8212; holistic  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/custom_style.css?v=ac75cb35" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'gallery/tutorials/bias/mitigating_bias/recommender_systems/examples/example_lastfm';</script>
    <link rel="icon" href="../../../../../../_static/holistic_ai.png"/>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../../_static/hai_logo.svg" class="logo__image only-light" alt="holistic  documentation - Home"/>
    <img src="https://assets-global.website-files.com/6305e5d42c283515c3e71b8c/63d771efd50a073bd66193f0_Holistic-AI-Logo-Horizontal-Dark.svg" class="logo__image only-dark pst-js-only" alt="holistic  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../index.html">
    Example Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../changelog/index.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/holistic_ai" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/holistic-ai/holisticai" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://join.slack.com/t/holisticaicommunity/shared_invite/zt-2jamouyrn-BrMfeoBZIHT8HbLzB3P9QQ" title="Community" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Community</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../index.html">
    Example Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../changelog/index.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/holistic_ai" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/holistic-ai/holisticai" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://join.slack.com/t/holisticaicommunity/shared_invite/zt-2jamouyrn-BrMfeoBZIHT8HbLzB3P9QQ" title="Community" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-slack fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Community</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis"><strong>Bias Measuring and Mitigation in Recommendation Systems</strong></span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Bias-Measuring-and-Mitigation-in-Recommendation-Systems">
<h1><strong>Bias Measuring and Mitigation in Recommendation Systems</strong><a class="headerlink" href="#Bias-Measuring-and-Mitigation-in-Recommendation-Systems" title="Link to this heading">#</a></h1>
<p>Bias in recommendation systems can arise when the predictions systematically deviate from the true values for certain subgroups in the dataset. This phenomenon can be due to various reasons, such as unbalanced groups in the training data, feature selection, or model specification. A recommendation system aims to recommend the best items according to user preferences, but bias can affect the fairness and accuracy of these recommendations.</p>
<p>To address this, various techniques can be used to measure bias in recommendation systems. Common approaches include using fairness metrics such as aggregate diversity, exposure entropy, or the Gini index, which are item-based metrics that calculate the distribution of items shown to users.</p>
<p>Once bias is detected, we can employ different techniques to mitigate it. These methods can be grouped into three categories: Pre-processing, In-processing, and Post-processing. Pre-processing techniques adjust the training data to remove bias, In-processing methods build robust models against bias, and Post-processing techniques adjust the model’s predictions to remove bias.</p>
<p>In this tutorial, we will demonstrate tools to measure and mitigate bias in recommender systems, focusing on predicting users’ music preferences using the “Last FM Dataset.” The outline of the tutorial is as follows:</p>
<ol class="arabic simple">
<li><p>Data Loading and Packages Installation</p></li>
<li><p>Data Exploration</p></li>
<li><p>Model Training</p></li>
<li><p>Bias Measurement</p></li>
<li><p>Bias Mitigation</p>
<ul class="simple">
<li><p>Blind Spot Aware Method</p></li>
<li><p>Debiasing learning method</p></li>
</ul>
</li>
<li><p>Results Comparison</p></li>
</ol>
<section id="1.-Data-Tasks:-Loading,-Exploration,-and-Preprocessing">
<h2><strong>1. Data Tasks: Loading, Exploration, and Preprocessing</strong><a class="headerlink" href="#1.-Data-Tasks:-Loading,-Exploration,-and-Preprocessing" title="Link to this heading">#</a></h2>
<p>First, we need to import the required packages to perform our bias analysis and mitigation. Ensure you have the <code class="docutils literal notranslate"><span class="pre">holisticai</span></code> package installed on your system by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>holisticai<span class="o">[</span>all<span class="o">]</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Base Imports</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.-Data-exploration">
<h2><strong>2. Data exploration</strong><a class="headerlink" href="#2.-Data-exploration" title="Link to this heading">#</a></h2>
<p>The dataset used is the “Last FM Dataset,” which contains a set of artists downloaded by users, along with user information such as sex and country of origin. We will use the column “score,” which contains 1s to count interactions.</p>
<p>Source: <a class="reference external" href="https://files.grouplens.org/datasets/hetrec2011/hetrec2011-lastfm-readme.txt">GroupLens</a></p>
<p>The load_dataset function from the holisticai package returns the preprocessed dataset. For the ‘lastfm’ dataset, it returns the processed pivot table as a numpy array and the protected attribute.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">holistic.datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;lastfm&#39;</span><span class="p">)</span>
<span class="n">df_pivot</span><span class="p">,</span> <span class="n">p_attr</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;data_pivot&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;p_attr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">holistic.bias.plots</span> <span class="kn">import</span> <span class="n">group_pie_plot</span>

<span class="n">group_pie_plot</span><span class="p">(</span><span class="n">p_attr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../../_images/gallery_tutorials_bias_mitigating_bias_recommender_systems_examples_example_lastfm_5_1.png" src="../../../../../../_images/gallery_tutorials_bias_mitigating_bias_recommender_systems_examples_example_lastfm_5_1.png" />
</div>
</div>
<p>This graph shows that the proportion of non-protected examples is very high compared to the protected group.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Unique Users : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of Unique Artists : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of Unique Users : 15000
Number of Unique Artists : 1004
</pre></div></div>
</div>
</section>
<section id="3.-Model-training">
<h2><strong>3. Model training</strong><a class="headerlink" href="#3.-Model-training" title="Link to this heading">#</a></h2>
<section id="Training-the-baseline">
<h3><strong>Training the baseline</strong><a class="headerlink" href="#Training-the-baseline" title="Link to this heading">#</a></h3>
<p>We will use item-based collaborative filtering to recommend artists to users. This approach involves finding the most similar artists and recommending them based on users’ preferences.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">items_liked_by_user</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">recommended_items</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">similarity_matrix</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">liked</span> <span class="o">=</span> <span class="n">items_liked_by_user</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">[</span><span class="n">liked</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">liked</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">arr</span><span class="p">)[</span><span class="o">-</span><span class="n">k</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">num_items</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_items</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">arr</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
<p>We prepare our pivoted table to calculate correlations and perform filtering to create a new pivoted table for user recommendations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">linear_kernel</span>

<span class="n">data_matrix</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">cosine_sim</span> <span class="o">=</span> <span class="n">linear_kernel</span><span class="p">(</span><span class="n">data_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">data_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">new_recs</span> <span class="o">=</span> <span class="p">[</span><span class="n">explode</span><span class="p">(</span><span class="n">recommended_items</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">cosine_sim</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="n">new_df_pivot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_recs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">new_df_pivot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>...and you will know us by the trail of dead</th>
      <th>2pac</th>
      <th>3 doors down</th>
      <th>30 seconds to mars</th>
      <th>311</th>
      <th>36 crazyfists</th>
      <th>44</th>
      <th>50 cent</th>
      <th>65daysofstatic</th>
      <th>Edith piaf</th>
      <th>...</th>
      <th>weezer</th>
      <th>wilco</th>
      <th>within temptation</th>
      <th>wolfgang amadeus mozart</th>
      <th>wu-tang clan</th>
      <th>yann tiersen</th>
      <th>yeah yeah yeahs</th>
      <th>yellowcard</th>
      <th>yo la tengo</th>
      <th>zero 7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1004 columns</p>
</div></div>
</div>
<p>Finally, we obtain our recommendation matrix:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">new_df_pivot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="4.-Bias-Measurement">
<h2><strong>4. Bias Measurement</strong><a class="headerlink" href="#4.-Bias-Measurement" title="Link to this heading">#</a></h2>
<p>We will calculate various fairness metrics for our recommendation matrix using the <code class="docutils literal notranslate"><span class="pre">recommender_bias_metrics</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">holistic.bias.metrics</span> <span class="kn">import</span> <span class="n">recommender_bias_metrics</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">recommender_bias_metrics</span><span class="p">(</span><span class="n">mat_pred</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span> <span class="n">metric_type</span><span class="o">=</span><span class="s1">&#39;item_based&#39;</span><span class="p">)</span>
<span class="n">df_baseline</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_baseline</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
      <th>Reference</th>
    </tr>
    <tr>
      <th>Metric</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aggregate Diversity</th>
      <td>0.417331</td>
      <td>1</td>
    </tr>
    <tr>
      <th>GINI index</th>
      <td>0.964381</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Exposure Distribution Entropy</th>
      <td>3.811313</td>
      <td>-</td>
    </tr>
    <tr>
      <th>Average Recommendation Popularity</th>
      <td>5725.978827</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The function computes metrics such as Aggregate Diversity and Gini Index, helping us analyze fairness in recommendations.</p>
</section>
<section id="5.-Bias-mitigation">
<h2><strong>5. Bias mitigation</strong><a class="headerlink" href="#5.-Bias-mitigation" title="Link to this heading">#</a></h2>
<p>Now that we could observe that the model metrics are far away from the desired values, we need to apply some kind of strategy to mitigate the bias present in the model.</p>
<p>Exists different kinds of strategies, and the literature has divided them into three categories: “Pre-processing”, “in-processing” and “post-processing” methods. The <code class="docutils literal notranslate"><span class="pre">holisticai</span></code> library possesses different algorithms from these categories for bias mitigation. An interesting feature is that all of them are compatible with the <code class="docutils literal notranslate"><span class="pre">Scikit-learn</span></code> package, so that, if you are familiar with this package, you will not have problems using the library.</p>
<section id="Inprocessing:-Blind-spot-aware-method">
<h3><strong>Inprocessing: Blind spot aware method</strong><a class="headerlink" href="#Inprocessing:-Blind-spot-aware-method" title="Link to this heading">#</a></h3>
<p>First, we will implement the “Blind spot aware” method which is a inprocessing algorithm that takes into account the blind spot inherent in the learning phase of the Recommender System. Where the blind spot size is the number of item with a predicted rating.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">holistic.bias.mitigation</span> <span class="kn">import</span> <span class="n">BlindSpotAwareMF</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">BlindSpotAwareMF</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">lamda</span><span class="o">=</span><span class="mf">0.008</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');

/* Light blue theme (default) */
.generic-object-container.blue {
    background-color: #f6feff !important; /* Container background: light blue */
    border-color: #4db6ac !important; /* Soft blue border */
}

.generic-object-header.blue {
    background-color: #d6faff !important; /* Header background: darker blue */
}

.generic-object-header.blue:hover {
    background-color: #80deea !important; /* Darker shade on hover over the header */
}

.attribute-list.blue:hover {
    background-color: #b2dfdb !important; /* Attribute background on hover: darker blue */
}

/* Orange theme */
.generic-object-container.orange {
    background-color: #fff9ef !important; /* Container background: light orange */
    border-color: #ffb74d !important; /* Soft orange border */
}

.generic-object-header.orange {
    background-color: #ffe0b2 !important; /* Header background: darker orange */
}

.generic-object-header.orange:hover {
    background-color: #ffcc80 !important; /* Darker shade on hover over the header */
}

.attribute-list.orange:hover {
    background-color: #ffe0b2 !important; /* Attribute background on hover: darker orange */
}

/* Green theme */
.generic-object-container.green {
    background-color: #f6fff6 !important; /* Container background: light green */
    border-color: #81c784 !important; /* Soft green border */
}

.generic-object-header.green {
    background-color: #c8e6c9 !important; /* Header background: darker green */
}

.generic-object-header.green:hover {
    background-color: #a5d6a7 !important; /* Darker shade on hover over the header */
}

.attribute-list.green:hover {
    background-color: #c8e6c9 !important; /* Attribute background on hover: darker green */
}

/* Align the first container to the left */
.generic-object-container.first-level {
    margin: 0;
    width: auto;
    max-width: 800px;
    display: block;
    box-sizing: border-box;
}

/* Nested containers stay centered */
.generic-object-container .generic-object-container {
    margin: 5px auto;
    width: 100%;
    display: block;
    padding: 5px 0;
}

/* Remove default background color so only themes apply it */
.generic-object-container {
    padding: 0;
    margin: 0 auto;
    border: 1px dashed;
    border-radius: 5px;
    display: block;
    width: auto;
    max-width: 800px;
    box-sizing: border-box;
    margin-bottom: 15px;
    transition: transform 0.2s, box-shadow 0.2s;
}

.generic-object-container:hover {
    box-shadow: 0px 4px 10px rgba(77, 182, 172, 0.3);
}

.generic-object-header {
    font-family: 'Montserrat', Arial, sans-serif;
    font-size: 14px;
    padding: 10px 20px;
    padding-left: 40px;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
    box-sizing: border-box;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.toggle-button {
    margin-right: 10px;
    background: none;
    border: none;
    font-size: 13px;
    cursor: pointer;
    position: absolute;
    left: 10px;
    color: #004d40;
}

.generic-object-body {
    padding: 5px 10px;
    display: block;
    border-radius: 0 0 5px 5px;
    background-color: inherit;
    margin: 0 auto;
}

.hidden {
    display: none;
}

.attribute-list {
    margin: 2px 0;
    padding: 2px;
    transition: background-color 0.2s;
    display: block;
}

.flex-space-filler {
    display: flex;
    justify-content: center;
    align-items: center;
}

    </style>
    <div style="display: flex;">
    <div class="generic-object-container blue first-level">
        <div class="generic-object-content">
            <div class="generic-object-header blue" onclick="toggleCollapse(this)">
                <button class="toggle-button blue">[-]</button> [BlindSpotAwareMF]
            </div>
            <div class="generic-object-body">
                <div class="attribute-list blue"><center>BlindSpotAwareMF(K=40, beta=0.02, steps=10, alpha=0.002, ...)</center></div><hr><div class="attribute-list blue"><strong>Type</strong>: Bias Mitigation Inprocessing</div>

            </div>
        </div>
    </div>
</div>
    <script>
    function toggleCollapse(element) {
        var body = element.nextElementSibling;
        var button = element.querySelector(".toggle-button");
        if (body.classList.contains('hidden')) {
            body.classList.remove('hidden');
            button.textContent = "[-]";
        } else {
            body.classList.add('hidden');
            button.textContent = "[+]";
        }
    }
    </script></div>
</div>
<p>We use the data matrix and protected groups to perform mitigation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recommended_items</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_matrix</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">recommended_items_mask</span> <span class="o">=</span> <span class="n">data_matrix</span><span class="o">&gt;</span><span class="mi">0</span>
    <span class="n">candidate_index</span> <span class="o">=</span> <span class="o">~</span><span class="n">recommended_items_mask</span>
    <span class="n">candidate_rating</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pred</span><span class="o">*</span><span class="n">candidate_index</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">candidate_rating</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,:</span><span class="n">k</span><span class="p">]</span>

<span class="n">new_items</span> <span class="o">=</span> <span class="n">recommended_items</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">data_matrix</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">new_recs</span> <span class="o">=</span> <span class="p">[</span><span class="n">explode</span><span class="p">(</span><span class="n">new_items</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="n">new_df_pivot_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_recs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">new_df_pivot_db</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">df_blind</span> <span class="o">=</span> <span class="n">recommender_bias_metrics</span><span class="p">(</span><span class="n">mat_pred</span><span class="o">=</span><span class="n">mat</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">metric_type</span><span class="o">=</span><span class="s1">&#39;item_based&#39;</span><span class="p">)</span>
<span class="n">df_blind</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
      <th>Reference</th>
    </tr>
    <tr>
      <th>Metric</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aggregate Diversity</th>
      <td>0.920319</td>
      <td>1</td>
    </tr>
    <tr>
      <th>GINI index</th>
      <td>0.646106</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Exposure Distribution Entropy</th>
      <td>6.150804</td>
      <td>-</td>
    </tr>
    <tr>
      <th>Average Recommendation Popularity</th>
      <td>478.088827</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Inprocessing:-Debiasing-Learning-Method">
<h3><strong>Inprocessing: Debiasing Learning Method</strong><a class="headerlink" href="#Inprocessing:-Debiasing-Learning-Method" title="Link to this heading">#</a></h3>
<p>We will also implement the “Debiasing Learning” method, which handles selection biases using models and techniques from causal inference.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="kn">from</span> <span class="nn">holistic.bias.mitigation</span> <span class="kn">import</span> <span class="n">DebiasingLearningMF</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">DebiasingLearningMF</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;Vanilla&#39;</span><span class="p">,</span> <span class="n">lamda</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">bias_mode</span><span class="o">=</span><span class="s1">&#39;Regularized&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">)</span>

<span class="n">new_items</span> <span class="o">=</span> <span class="n">recommended_items</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">data_matrix</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">new_recs</span> <span class="o">=</span> <span class="p">[</span><span class="n">explode</span><span class="p">(</span><span class="n">new_items</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="n">new_df_pivot_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_recs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">new_df_pivot_db</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">recommender_bias_metrics</span><span class="p">(</span><span class="n">mat_pred</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span> <span class="n">metric_type</span><span class="o">=</span><span class="s1">&#39;item_based&#39;</span><span class="p">)</span>
<span class="n">df_debl</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_debl</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
      <th>Reference</th>
    </tr>
    <tr>
      <th>Metric</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aggregate Diversity</th>
      <td>0.430279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>GINI index</th>
      <td>0.849489</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Exposure Distribution Entropy</th>
      <td>5.317608</td>
      <td>-</td>
    </tr>
    <tr>
      <th>Average Recommendation Popularity</th>
      <td>931.340987</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="6.-Results-comparison">
<h3><strong>6. Results comparison</strong><a class="headerlink" href="#6.-Results-comparison" title="Link to this heading">#</a></h3>
<p>We compare the results between the baseline and the mitigated models to analyze how the metrics have changed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_baseline</span><span class="p">,</span> <span class="n">df_blind</span><span class="p">,</span> <span class="n">df_debl</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">result</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span><span class="s1">&#39;Blind spot&#39;</span><span class="p">,</span> <span class="s1">&#39;Debiasing&#39;</span><span class="p">,</span> <span class="s1">&#39;Reference&#39;</span><span class="p">]</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Baseline</th>
      <th>Blind spot</th>
      <th>Debiasing</th>
      <th>Reference</th>
    </tr>
    <tr>
      <th>Metric</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aggregate Diversity</th>
      <td>0.417331</td>
      <td>0.920319</td>
      <td>0.430279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>GINI index</th>
      <td>0.964381</td>
      <td>0.646106</td>
      <td>0.849489</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Exposure Distribution Entropy</th>
      <td>3.811313</td>
      <td>6.150804</td>
      <td>5.317608</td>
      <td>-</td>
    </tr>
    <tr>
      <th>Average Recommendation Popularity</th>
      <td>5725.978827</td>
      <td>478.088827</td>
      <td>931.340987</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>From the chart, we observe that although some metrics are still far from ideal, there is an improvement compared to the baseline. Overall, the Blind Spot mitigation method consistently outperforms the baseline and Debiasing learning method across all metrics, demonstrating its effectiveness in reducing bias and enhancing the fairness of recommendations for this particular case.</p>
</section>
</section>
<section id="Summary">
<h2><strong>Summary</strong><a class="headerlink" href="#Summary" title="Link to this heading">#</a></h2>
<p>This tutorial explored the issue of bias in recommendation systems, focusing on identifying and mitigating bias to enhance fairness and accuracy. Using the “Last FM Dataset,” we demonstrated how to measure bias using various metrics and mitigate it through different techniques using the <code class="docutils literal notranslate"><span class="pre">holisticai</span></code> library. We presented in-processing mitigation methods like “Blind Spot Aware” and “Debiasing Learning” to illustrate their impact on recommendation fairness.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Holistic AI.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>